<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoRepuestos - E-commerce Multi-tienda</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
        .view { display: none; }
        .view.active { display: block; }
        .product-card { transition: transform 0.2s; }
        .product-card:hover { transform: translateY(-4px); }
        .stock-bar { height: 4px; border-radius: 2px; }
        .modal { background: rgba(0,0,0,0.5); }
        .btn-primary { @apply bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors; }
        .btn-success { @apply bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors; }
        .btn-danger { @apply bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors; }
        .btn-warning { @apply bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition-colors; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navbar -->
    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2 cursor-pointer" onclick="showView('home')">
                        <div class="w-8 h-8 bg-blue-600 rounded flex items-center justify-center">
                            <i data-lucide="car" class="w-5 h-5 text-white"></i>
                        </div>
                        <span class="font-bold text-xl">AutoRepuestos</span>
                    </div>
                </div>
                
                <div class="hidden md:flex space-x-6">
                    <button onclick="showView('catalogo')" class="text-gray-700 hover:text-blue-600 font-medium">Cat√°logo</button>
                    <button onclick="showView('contacto')" class="text-gray-700 hover:text-blue-600 font-medium">Contacto</button>
                    <button id="adminBtn" onclick="showView('admin')" class="text-gray-700 hover:text-blue-600 font-medium hidden">Admin</button>
                </div>
                
                <div class="flex items-center space-x-4">
                    <button onclick="showView('carrito')" class="relative p-2 text-gray-700 hover:text-blue-600">
                        <i data-lucide="shopping-cart" class="w-6 h-6"></i>
                        <span id="cartCount" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
                    </button>
                    <button id="loginBtn" onclick="showLoginModal()" class="btn-primary">Iniciar Sesi√≥n</button>
                    <button id="logoutBtn" onclick="logout()" class="btn-danger hidden">Cerrar Sesi√≥n</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- Home View -->
        <div id="home" class="view active">
            <div class="text-center py-12">
                <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
                    Repuestos Pl√°sticos Externos para Autos
                </h1>
                <p class="text-xl text-gray-600 mb-8">
                    Compra online, consulta disponibilidad por tienda y recibe reportes claros de tus ventas
                </p>
                
                <div class="grid md:grid-cols-3 gap-6 max-w-4xl mx-auto">
                    <div onclick="showView('catalogo')" class="bg-white p-8 rounded-xl shadow-lg cursor-pointer hover:shadow-xl transition-shadow">
                        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="grid-3x3" class="w-8 h-8 text-blue-600"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">Ver Cat√°logo</h3>
                        <p class="text-gray-600">Explora nuestro inventario multi-tienda</p>
                    </div>
                    
                    <div onclick="showView('contacto')" class="bg-white p-8 rounded-xl shadow-lg cursor-pointer hover:shadow-xl transition-shadow">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="message-circle" class="w-8 h-8 text-green-600"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">Contacto</h3>
                        <p class="text-gray-600">Consulta por WhatsApp al instante</p>
                    </div>
                    
                    <div id="adminCard" onclick="showView('admin')" class="bg-white p-8 rounded-xl shadow-lg cursor-pointer hover:shadow-xl transition-shadow hidden">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="bar-chart-3" class="w-8 h-8 text-purple-600"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">Panel Admin</h3>
                        <p class="text-gray-600">Gestiona inventarios y reportes</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Catalog View -->
        <div id="catalogo" class="view">
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">Cat√°logo de Productos</h2>
                <p class="text-gray-600">Selecciona una tienda para ver inventario espec√≠fico</p>
            </div>
            
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">Filtrar por Tienda:</label>
                <select id="storeFilter" onchange="filterByStore()" class="border border-gray-300 rounded-lg px-4 py-2 w-full md:w-64">
                    <option value="">Todas las Tiendas</option>
                </select>
            </div>
            
            <div id="catalogGrid" class="grid md:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- Products will be loaded here -->
            </div>
        </div>

        <!-- Product Detail View -->
        <div id="producto" class="view">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <button onclick="showView('catalogo')" class="mb-4 text-blue-600 hover:text-blue-800 flex items-center">
                    <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>
                    Volver al cat√°logo
                </button>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <img id="productImage" src="/placeholder.png" alt="" class="w-full h-80 object-cover rounded-lg">
                    </div>
                    
                    <div>
                        <h1 id="productName" class="text-3xl font-bold mb-4"></h1>
                        <p id="productDescription" class="text-gray-600 mb-4"></p>
                        <p class="text-3xl font-bold text-blue-600 mb-4">Bs. <span id="productPrice"></span></p>
                        
                        <div class="mb-6">
                            <h3 class="font-semibold mb-2">Disponibilidad por Tienda:</h3>
                            <div id="storeStock" class="space-y-2">
                                <!-- Stock info will be loaded here -->
                            </div>
                        </div>
                        
                        <div class="flex space-x-4">
                            <button onclick="addToCartFromDetail()" class="btn-primary flex-1">
                                <i data-lucide="shopping-cart" class="w-4 h-4 mr-2 inline"></i>
                                Agregar al Carrito
                            </button>
                            <button id="whatsAppBtn" class="btn-success">
                                <i data-lucide="message-circle" class="w-4 h-4 mr-2 inline"></i>
                                WhatsApp
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cart View -->
        <div id="carrito" class="view">
            <h2 class="text-3xl font-bold text-gray-900 mb-6">Carrito de Compras</h2>
            
            <div class="grid lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2">
                    <div id="cartItems" class="space-y-4">
                        <!-- Cart items will be loaded here -->
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold mb-4">Resumen</h3>
                    <div class="space-y-2 mb-4">
                        <div class="flex justify-between">
                            <span>Subtotal:</span>
                            <span>Bs. <span id="cartSubtotal">0.00</span></span>
                        </div>
                        <div class="flex justify-between">
                            <span>Env√≠o:</span>
                            <span>Bs. <span id="cartShipping">0.00</span></span>
                        </div>
                        <div class="border-t pt-2 flex justify-between font-bold text-lg">
                            <span>Total:</span>
                            <span>Bs. <span id="cartTotal">0.00</span></span>
                        </div>
                    </div>
                    
                    <button onclick="checkout()" class="btn-primary w-full mb-2">
                        Proceder al Pago
                    </button>
                    <button onclick="showView('catalogo')" class="btn-warning w-full">
                        Seguir Comprando
                    </button>
                </div>
            </div>
        </div>

        <!-- Contact View -->
        <div id="contacto" class="view">
            <div class="max-w-2xl mx-auto">
                <h2 class="text-3xl font-bold text-gray-900 mb-6 text-center">Cont√°ctanos por WhatsApp</h2>
                
                <div class="bg-white rounded-xl shadow-lg p-8">
                    <div class="text-center mb-8">
                        <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="message-circle" class="w-10 h-10 text-green-600"></i>
                        </div>
                        <p class="text-gray-600 mb-4">
                            Consulta disponibilidad, precios y realiza cotizaciones al instante
                        </p>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Producto de inter√©s:</label>
                            <input id="whatsappProduct" type="text" placeholder="Ej: Parachoques delantero Modelo X" 
                                   class="w-full border border-gray-300 rounded-lg px-4 py-2">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Cantidad:</label>
                            <input id="whatsappQuantity" type="number" min="1" value="1" 
                                   class="w-full border border-gray-300 rounded-lg px-4 py-2">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tienda preferida:</label>
                            <select id="whatsappStore" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                                <option value="">Cualquier tienda</option>
                            </select>
                        </div>
                        
                        <button onclick="sendWhatsApp()" class="btn-success w-full">
                            <i data-lucide="message-circle" class="w-4 h-4 mr-2 inline"></i>
                            Enviar Consulta por WhatsApp
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="admin" class="view">
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">Panel de Administraci√≥n</h2>
                <p class="text-gray-600">Gesti√≥n de inventarios, tiendas y reportes</p>
            </div>
            
            <div class="grid md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Productos</p>
                            <p id="totalProducts" class="text-2xl font-bold">0</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                            <i data-lucide="package" class="w-6 h-6 text-blue-600"></i>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Tiendas</p>
                            <p id="totalStores" class="text-2xl font-bold">0</p>
                        </div>
                        <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                            <i data-lucide="store" class="w-6 h-6 text-green-600"></i>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Total Stock</p>
                            <p id="totalStock" class="text-2xl font-bold">0</p>
                        </div>
                        <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center">
                            <i data-lucide="layers" class="w-6 h-6 text-yellow-600"></i>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Ventas</p>
                            <p id="totalSales" class="text-2xl font-bold">0</p>
                        </div>
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                            <i data-lucide="dollar-sign" class="w-6 h-6 text-purple-600"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="grid md:grid-cols-3 gap-6 mb-8">
                <button onclick="showAdminSection('inventarios')" class="bg-white rounded-xl shadow p-6 hover:shadow-lg transition-shadow text-left">
                    <h3 class="font-semibold mb-2">üì¶ Gestionar Inventarios</h3>
                    <p class="text-gray-600 text-sm">Transferir stock entre tiendas</p>
                </button>
                
                <button onclick="showAdminSection('productos')" class="bg-white rounded-xl shadow p-6 hover:shadow-lg transition-shadow text-left">
                    <h3 class="font-semibold mb-2">üè∑Ô∏è Productos</h3>
                    <p class="text-gray-600 text-sm">Agregar, editar o eliminar productos</p>
                </button>
                
                <button onclick="showAdminSection('reportes')" class="bg-white rounded-xl shadow p-6 hover:shadow-lg transition-shadow text-left">
                    <h3 class="font-semibold mb-2">üìä Reportes</h3>
                    <p class="text-gray-600 text-sm">Ventas y eficiencia por tienda</p>
                </button>
            </div>
            
            <!-- Admin Sections -->
            <div id="adminInventarios" class="admin-section hidden">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold mb-4">Transferir Inventario</h3>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Producto:</label>
                            <select id="transferProduct" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                                <option value="">Selecciona un producto</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Cantidad:</label>
                            <input id="transferQuantity" type="number" min="1" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Desde Tienda:</label>
                            <select id="transferFromStore" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                                <option value="">Selecciona tienda origen</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Hacia Tienda:</label>
                            <select id="transferToStore" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                                <option value="">Selecciona tienda destino</option>
                            </select>
                        </div>
                    </div>
                    
                    <button onclick="transferStock()" class="btn-primary mt-4">
                        <i data-lucide="truck" class="w-4 h-4 mr-2 inline"></i>
                        Transferir Stock
                    </button>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6 mt-6">
                    <h3 class="text-xl font-semibold mb-4">Inventario por Tienda</h3>
                    <div id="inventoryTable" class="overflow-x-auto">
                        <!-- Inventory table will be loaded here -->
                    </div>
                </div>
            </div>
            
            <div id="adminProductos" class="admin-section hidden">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold">Gesti√≥n de Productos</h3>
                        <button onclick="showAddProductModal()" class="btn-success">
                            <i data-lucide="plus" class="w-4 h-4 mr-2 inline"></i>
                            Nuevo Producto
                        </button>
                    </div>
                    
                    <div id="productsTable" class="overflow-x-auto">
                        <!-- Products table will be loaded here -->
                    </div>
                </div>
            </div>
            
            <div id="adminReportes" class="admin-section hidden">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold mb-4">Reportes de Ventas</h3>
                    
                    <div class="grid md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <h4 class="font-semibold mb-2">Ventas por Tienda</h4>
                            <div id="salesByStore" class="space-y-2">
                                <!-- Sales data will be loaded here -->
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold mb-2">Top 10 Productos M√°s Vendidos</h4>
                            <div id="topProducts" class="space-y-2">
                                <!-- Top products will be loaded here -->
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="generateSalesReport()" class="btn-primary">
                        <i data-lucide="download" class="w-4 h-4 mr-2 inline"></i>
                        Descargar Reporte Completo
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white mt-16">
        <div class="max-w-7xl mx-auto px-4 py-8">
            <div class="text-center">
                <p class="text-gray-400">¬© 2024 AutoRepuestos - Sistema Multi-tienda</p>
                <p class="text-gray-500 text-sm mt-2">Gesti√≥n integral de inventarios y ventas</p>
            </div>
        </div>
    </footer>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 modal hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-xl p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold mb-6">Iniciar Sesi√≥n</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email:</label>
                    <input id="loginEmail" type="email" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Contrase√±a:</label>
                    <input id="loginPassword" type="password" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                </div>
                
                <div class="flex space-x-4 pt-4">
                    <button onclick="login()" class="btn-primary flex-1">Ingresar</button>
                    <button onclick="closeLoginModal()" class="btn-warning">Cancelar</button>
                </div>
            </div>
            
            <div class="mt-4 text-center text-sm text-gray-600">
                <p>Demo: admin@autorepuestos.com / admin123</p>
                <p>manager@autorepuestos.com / manager123</p>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="fixed inset-0 modal hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-2xl font-bold mb-6">Nuevo Producto</h3>
            
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nombre:</label>
                    <input id="newProductName" type="text" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Slug (URL):</label>
                    <input id="newProductSlug" type="text" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Descripci√≥n:</label>
                    <textarea id="newProductDescription" rows="3" class="w-full border border-gray-300 rounded-lg px-4 py-2"></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Precio (Bs.):</label>
                    <input id="newProductPrice" type="number" step="0.01" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">URL Imagen:</label>
                    <input id="newProductImage" type="text" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Stock por Tienda:</label>
                    <div id="newProductStock" class="space-y-2">
                        <!-- Stock inputs will be generated here -->
                    </div>
                </div>
            </div>
            
            <div class="flex space-x-4 pt-6">
                <button onclick="addProduct()" class="btn-success">Guardar Producto</button>
                <button onclick="closeAddProductModal()" class="btn-warning">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Data Store
        const STORAGE_KEYS = {
            PRODUCTS: 'autorepuestos_products',
            STORES: 'autorepuestos_stores',
            STOCK: 'autorepuestos_stock',
            CART: 'autorepuestos_cart',
            USERS: 'autorepuestos_users',
            CURRENT_USER: 'autorepuestos_current_user',
            ORDERS: 'autorepuestos_orders',
            TRANSFERS: 'autorepuestos_transfers'
        };

        // Initialize default data
        function initializeData() {
            if (!localStorage.getItem(STORAGE_KEYS.STORES)) {
                const stores = [
                    { id: 'store-1', name: 'Tienda Central', nit: '12345601', address: 'Av. Principal 100', phone: '59171234567' },
                    { id: 'store-2', name: 'Tienda Norte', nit: '12345602', address: 'Calle Norte 50', phone: '59171234568' },
                    { id: 'store-3', name: 'Tienda Sur', nit: '12345603', address: 'Av. Sur 200', phone: '59171234569' },
                    { id: 'store-4', name: 'Tienda Este', nit: '12345604', address: 'Av. Este 300', phone: '59171234570' },
                    { id: 'store-5', name: 'Tienda Oeste', nit: '12345605', address: 'Calle Oeste 20', phone: '59171234571' }
                ];
                localStorage.setItem(STORAGE_KEYS.STORES, JSON.stringify(stores));
            }

            if (!localStorage.getItem(STORAGE_KEYS.PRODUCTS)) {
                const products = [
                    {
                        id: 'prod-1',
                        name: 'Parachoques delantero Modelo X',
                        slug: 'parachoques-delantero-modelo-x',
                        description: 'Pl√°stico externo de alta resistencia, compatible con Modelo X 2020-2024',
                        price: '490.00',
                        imageUrl: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=400'
                    },
                    {
                        id: 'prod-2',
                        name: 'Retrovisor izquierdo Modelo Y',
                        slug: 'retrovisor-izquierdo-modelo-y',
                        description: 'Retrovisor completo con carcasa pl√°stica y cristal templado',
                        price: '220.00',
                        imageUrl: 'https://images.unsplash.com/photo-1552519507-da3b142c6e3d?w=400'
                    },
                    {
                        id: 'prod-3',
                        name: 'Defensa trasera Modelo Z',
                        slug: 'defensa-trasera-modelo-z',
                        description: 'Defensa trasera en material ABS reforzado',
                        price: '380.00',
                        imageUrl: 'https://images.unsplash.com/photo-1563137391-eb27b8c56c19?w=400'
                    },
                    {
                        id: 'prod-4',
                        name: 'Cubiertas de rueda Modelo A',
                        slug: 'cubiertas-rueda-modelo-a',
                        description: 'Juego de 4 cubiertas pl√°sticas para ruedas 15"',
                        price: '180.00',
                        imageUrl: 'https://images.unsplash.com/photo-1592198084033-aade902d1aae?w=400'
                    }
                ];
                localStorage.setItem(STORAGE_KEYS.PRODUCTS, JSON.stringify(products));
            }

            if (!localStorage.getItem(STORAGE_KEYS.STOCK)) {
                const stores = JSON.parse(localStorage.getItem(STORAGE_KEYS.STORES));
                const products = JSON.parse(localStorage.getItem(STORAGE_KEYS.PRODUCTS));
                const stock = [];
                
                products.forEach(product => {
                    stores.forEach(store => {
                        stock.push({
                            id: `stock-${product.id}-${store.id}`,
                            productId: product.id,
                            storeId: store.id,
                            quantity: Math.floor(Math.random() * 10) + 1,
                            updatedAt: new Date().toISOString()
                        });
                    });
                });
                
                localStorage.setItem(STORAGE_KEYS.STOCK, JSON.stringify(stock));
            }

            if (!localStorage.getItem(STORAGE_KEYS.USERS)) {
                const users = [
                    { id: 'user-1', name: 'Admin', email: 'admin@autorepuestos.com', password: 'admin123', role: 'ADMIN' },
                    { id: 'user-2', name: 'Manager Norte', email: 'manager@autorepuestos.com', password: 'manager123', role: 'MANAGER' },
                    { id: 'user-3', name: 'Cliente Demo', email: 'cliente@autorepuestos.com', password: 'cliente123', role: 'CLIENTE' }
                ];
                localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users));
            }

            if (!localStorage.getItem(STORAGE_KEYS.CART)) {
                localStorage.setItem(STORAGE_KEYS.CART, JSON.stringify([]));
            }

            if (!localStorage.getItem(STORAGE_KEYS.ORDERS)) {
                localStorage.setItem(STORAGE_KEYS.ORDERS, JSON.stringify([]));
            }

            if (!localStorage.getItem(STORAGE_KEYS.TRANSFERS)) {
                localStorage.setItem(STORAGE_KEYS.TRANSFERS, JSON.stringify([]));
            }
        }

        // Navigation
        function showView(viewName) {
            document.querySelectorAll('.view').forEach(view => view.classList.remove('active'));
            document.getElementById(viewName).classList.add('active');
            
            if (viewName === 'catalogo') {
                loadCatalog();
            } else if (viewName === 'admin') {
                loadAdminDashboard();
            }
            
            window.scrollTo(0, 0);
        }

        function showAdminSection(section) {
            document.querySelectorAll('.admin-section').forEach(s => s.classList.add('hidden'));
            document.getElementById(`admin${section.charAt(0).toUpperCase() + section.slice(1)}`).classList.remove('hidden');
            
            if (section === 'inventarios') {
                loadInventoryTable();
                loadTransferForm();
            } else if (section === 'productos') {
                loadProductsTable();
            } else if (section === 'reportes') {
                loadReports();
            }
        }

        // Authentication
        function showLoginModal() {
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('loginModal').classList.add('flex');
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('loginModal').classList.remove('flex');
        }

        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const users = JSON.parse(localStorage.getItem(STORAGE_KEYS.USERS));
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                localStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(user));
                updateUIForLoggedInUser();
                closeLoginModal();
                
                if (user.role === 'ADMIN' || user.role === 'MANAGER') {
                    showView('admin');
                }
                
                alert(`Bienvenido, ${user.name}!`);
            } else {
                alert('Credenciales inv√°lidas');
            }
        }

        function logout() {
            localStorage.removeItem(STORAGE_KEYS.CURRENT_USER);
            updateUIForLoggedOutUser();
            showView('home');
        }

        function updateUIForLoggedInUser() {
            const user = JSON.parse(localStorage.getItem(STORAGE_KEYS.CURRENT_USER));
            if (!user) return;
            
            document.getElementById('loginBtn').classList.add('hidden');
            document.getElementById('logoutBtn').classList.remove('hidden');
            
            if (user.role === 'ADMIN' || user.role === 'MANAGER') {
                document.getElementById('adminBtn').classList.remove('hidden');
                document.getElementById('adminCard').classList.remove('hidden');
            }
        }

        function updateUIForLoggedOutUser() {
            document.getElementById('loginBtn').classList.remove('hidden');
            document.getElementById('logoutBtn').classList.add('hidden');
            document.getElementById('adminBtn').classList.add('hidden');
            document.getElementById('adminCard').classList.add('hidden');
        }

        // Catalog
        function loadCatalog() {
            const products = JSON.parse(localStorage.getItem(STORAGE_KEYS.PRODUCTS));
            const stock = JSON.parse(localStorage.getItem(STORAGE_KEYS.STOCK));
            const stores = JSON.parse(localStorage.getItem(STORAGE_KEYS.STORES));
            
            const storeFilter = document.getElementById('storeFilter');
            storeFilter.innerHTML = '<option value="">Todas las Tiendas</option>';
            stores.forEach(store => {
                storeFilter.innerHTML += `<option value="${store.id}">${store.name}</option>`;
            });
            
            const grid = document.getElementById('catalogGrid');
            grid.innerHTML = '';
            
            products.forEach(product => {
                const productStock = stock.filter(s => s.productId === product.id);
                const totalStock = productStock.reduce((sum, s) => sum + s.quantity, 0);
                
                const maxStock = Math.max(...productStock.map(s => s.quantity), 1);
                const stockBars = productStock.map(s => {
                    const width = (s.quantity / maxStock) * 100;
                    const color = s.quantity > 5 ? 'bg-green-500' : s.quantity > 2 ? 'bg-yellow-500' : 'bg-red-500';
                    return `<div class="stock-bar ${color}" style="width: ${width}%"></div>`;
                }).join('');
                
                grid.innerHTML += `
                    <div class="product-card bg-white rounded-xl shadow-lg overflow-hidden">
                        <img src="${product.imageUrl}" alt="${product.name}" class="w-full h-48 object-cover">
                        <div class="p-4">
                            <h3 class="font-semibold text-lg mb-2">${product.name}</h3>
                            <p class="text-gray-600 text-sm mb-3">${product.description.substring(0, 80)}...</p>
                            <p class="text-2xl font-bold text-blue-600 mb-2">Bs. ${product.price}</p>
                            <div class="mb-3">
                                <div class="flex space-x-1">${stockBars}</div>
                                <p class="text-xs text-gray-600 mt-1">Stock total: ${totalStock}</p>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="viewProduct('${product.id}')" class="btn-primary flex-1 text-sm">
                                    Ver Detalle
                                </button>
                                <button onclick="addToCart('${product.id}')" class="btn-success text-sm">
                                    <i data-lucide="shopping-cart" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            lucide.createIcons();
        }

        function filterByStore() {
            const storeId = document.getElementById('storeFilter').value;
            const products = JSON.parse(localStorage.getItem(STORAGE_KEYS.PRODUCTS));
            const stock = JSON.parse(localStorage.getItem(STORAGE_KEYS.STOCK));
            const grid = document.getElementById('catalogGrid');
            
            grid.innerHTML = '';
            
            products.forEach(product => {
                const productStock = stock.filter(s => s.productId === product.id);
                let showProduct = true;
                let stockText = '';
                
                if (storeId) {
                    const storeStock = productStock.find(s => s.storeId === storeId);
                    if (!storeStock || storeStock.quantity === 0) {
                        showProduct = false;
                    } else {
                        stockText = `Stock: ${storeStock.quantity}`;
                    }
                } else {
                    const totalStock = productStock.reduce((sum, s) => sum + s.quantity, 0);
                    stockText = `Stock total: ${totalStock}`;
                }
                
                if (!showProduct) return;
                
                grid.innerHTML += `
                    <div class="product-card bg-white rounded-xl shadow-lg overflow-hidden">
                        <img src="${product.imageUrl}" alt="${product.name}" class="w-full h-48 object-cover">
                        <div class="p-4">
                            <h3 class="font-semibold text-lg mb-2">${product.name}</h3>
                            <p class="text-gray-600 text-sm mb-3">${product.description.substring(0, 80)}...</p>
                            <p class="text-2xl font-bold text-blue-600 mb-2">Bs. ${product.price}</p>
                            <p class="text-xs text-gray-600 mb-3">${stockText}</p>
                            <div class="flex space-x-2">
                                <button onclick="viewProduct('${product.id}')" class="btn-primary flex-1 text-sm">
                                    Ver Detalle
                                </button>
                                <button onclick="addToCart('${product.id}')" class="btn-success text-sm">
                                    <i data-lucide="shopping-cart" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            lucide.createIcons();
        }

        function viewProduct(productId) {
            const products = JSON.parse(localStorage.getItem(STORAGE_KEYS.PRODUCTS));
            const stock = JSON.parse(localStorage.getItem(STORAGE_KEYS.STOCK));
            const stores = JSON.parse(localStorage.getItem(STORAGE_KEYS.STORES));
            
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            document.getElementById('productName').textContent = product.name;
            document.getElementById('productDescription').textContent = product.description;
            document.getElementById('productPrice').textContent = product.price;
            document.getElementById('productImage').src = product.imageUrl;
            
            const storeStock = document.getElementById('storeStock');
            storeStock.innerHTML = '';
            
            stock.filter(s => s.productId === productId).forEach(s => {
                const store = stores.find(st => st.id === s.storeId);
                const color = s.quantity > 5 ? 'text-green-600' : s.quantity > 2 ? 'text-yellow-600' : 'text-red-600';
                storeStock.innerHTML += `
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                        <span>${store.name}</span>
                        <span class="font-semibold ${color}">${s.quantity} unidades</span>
                    </div>
                `;
            });
            
            // Set WhatsApp button
            const whatsAppBtn = document.getElementById('whatsAppBtn');
            whatsAppBtn.onclick = () => {
                const phone = stores[0].phone; // Use first store's phone
                const text = encodeURIComponent(`Hola, quiero cotizar:\nProducto: ${product.name}\nSKU: ${product.id}\nCantidad: 1\n¬øDisponibilidad y precio?`);
                window.open(`https://wa.me/${phone}?text=${text}`, '_blank');
            };
            
            // Store current product for add to cart
            window.currentProduct = product;
            
            showView('producto');
        }

        // Cart
        function addToCart(productId) {
            const products = JSON.parse(localStorage.getItem(STORAGE_KEYS.PRODUCTS));
            const cart = JSON.parse(localStorage.getItem(STORAGE_KEYS.CART));
            
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const existingItem = cart.find(item => item.productId === productId);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    productId: productId,
                    quantity: 1,
                    price: product.price,
                    name: product.name,
                    imageUrl: product.imageUrl
                });
            }
            
            localStorage.setItem(STORAGE_KEYS.CART, JSON.stringify(cart));
            updateCartCount();
            alert('Producto agregado al carrito');
        }

        function addToCartFromDetail() {
            if (window.currentProduct) {
                addToCart(window.currentProduct.id);
            }
        }

        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem(STORAGE_KEYS.CART));
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            const cartCount = document.getElementById('cartCount');
            
            if (count > 0) {
                cartCount.textContent = count;
                cartCount.classList.remove('hidden');
            } else {
                cartCount.classList.add('hidden');
            }
        }

        function loadCart() {
            const cart = JSON.parse(localStorage.getItem(STORAGE_KEYS.CART));
            const cartItems = document.getElementById('cartItems');
            
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="bg-white rounded-xl shadow p-8 text-center">
                        <i data-lucide="shopping-cart" class="w-16 h-16 text-gray-400 mx-auto mb-4"></i>
                        <p class="text-gray-600">Tu carrito est√° vac√≠o</p>
                        <button onclick="showView('catalogo')" class="btn-primary mt-4">
                            Ir al Cat√°logo
                        </button>
                    </div>
                `;
                lucide.createIcons();
                return;
            }
            
            cartItems.innerHTML = '';
            let subtotal = 0;
            
            cart.forEach(item => {
                const itemTotal = parseFloat(item.price) * item.quantity;
                subtotal += itemTotal;
                
                cartItems.innerHTML += `
                    <div class="bg-white rounded-xl shadow p-4 flex items-center space-x-4">
                        <img src="${item.imageUrl}" alt="${item.name}" class="w-20 h-20 object-cover rounded-lg">
                        <div class="flex-1">
                            <h3 class="font-semibold">${item.name}</h3>
                            <p class="text-gray-600">Bs. ${item.price}</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="updateCartItem('${item.productId}', ${item.quantity - 1})" 
                                    class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center">-</button>
                            <span class="w-8 text-center">${item.quantity}</span>
                            <button onclick="updateCartItem('${item.productId}', ${item.quantity + 1})" 
                                    class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center">+</button>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold">Bs. ${itemTotal.toFixed(2)}</p>
                            <button onclick="removeFromCart('${item.productId}')" class="text-red-600 text-sm">Eliminar</button>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('cartSubtotal').textContent = subtotal.toFixed(2);
            document.getElementById('cartShipping').textContent = '0.00';
            document.getElementById('cartTotal').textContent = subtotal.toFixed(2);
        }

        function updateCartItem(productId, newQuantity) {
            if (newQuantity <= 0) {
                removeFromCart(productId);
                return;
            }
            
            const cart = JSON.parse(localStorage.getItem(STORAGE_KEYS.CART));
            const item = cart.find(item => item.productId === productId);
            if (item) {
                item.quantity = newQuantity;
                localStorage.setItem(STORAGE_KEYS.CART, JSON.stringify(cart));
                loadCart();
                updateCartCount();
            }
        }

        function removeFromCart(productId) {
            let cart = JSON.parse(localStorage.getItem(STORAGE_KEYS.CART));
            cart = cart.filter(item => item.productId !== productId);
            localStorage.setItem(STORAGE_KEYS.CART, JSON.stringify(cart));
            loadCart();
            updateCartCount();
        }

        function checkout() {
            const cart = JSON.parse(localStorage.getItem(STORAGE_KEYS.CART));
            if (cart.length === 0) {
                alert('Tu carrito est√° vac√≠o');
                return;
            }
            
            // Simulate checkout process
            alert('Procesando pago con Stripe (simulado)...\n\nRedirigiendo a checkout seguro...');
            
            // In real implementation, this would create a Stripe session
            // For demo, we'll simulate a successful order
            const order = {
                id: 'order-' + Date.now(),
                items: [...cart],
                total: cart.reduce((sum, item) => sum + (parseFloat(item.price) * item.quantity), 0),
                status: 'PAID',
                createdAt: new Date().toISOString()
            };
            
            const orders = JSON.parse(localStorage.getItem(STORAGE_KEYS.ORDERS));
            orders.push(order);
            localStorage.setItem(STORAGE_KEYS.ORDERS, JSON.stringify(orders));
            
            // Clear cart
            localStorage.setItem(STORAGE_KEYS.CART, JSON.stringify([]));
            updateCartCount();
            
            alert('¬°Pedido realizado con √©xito! Gracias por tu compra.');
            showView('home');
        }

        // WhatsApp Integration
        function sendWhatsApp() {
            const product = document.getElementById('whatsappProduct').value;
            const quantity = document.getElementById('whatsappQuantity').value;
            const storeId = document.getElementById('whatsappStore').value;
            
            const stores = JSON.parse(localStorage.getItem(STORAGE_KEYS.STORES));
            const store = stores.find(s => s.id === storeId);
            const phone = store ? store.phone : stores[0].phone;
            
            const text = encodeURIComponent(
                `Hola, quiero cotizar:\nProducto: ${product}\nCantidad: ${quantity}\n${store ? `Tienda: ${store.name}\n` : ''}¬øDisponibilidad y precio?`
            );
            
            window.open(`https://wa.me/${phone}?text=${text}`, '_blank');
        }

        // Admin Functions
        function loadAdminDashboard() {
            const products = JSON.parse(localStorage.getItem(STORAGE_KEYS.PRODUCTS));
            const stores = JSON.parse(localStorage.getItem(STORAGE_KEYS.STORES));
            const stock = JSON.parse(localStorage.getItem(STORAGE_KEYS.STOCK));
            const orders = JSON.parse(localStorage.getItem(STORAGE_KEYS.ORDERS));
            
            document.getElementById('totalProducts').textContent = products.length;
            document.getElementById('totalStores').textContent = stores.length;
            document.getElementById('totalStock').textContent = stock.reduce((sum, s) => sum + s.quantity, 0);
            document.getElementById('totalSales').textContent = orders.length;
        }

        function loadTransferForm() {
            const products = JSON.parse(localStorage.getItem(STORAGE_KEYS.PRODUCTS));
            const stores = JSON.parse(localStorage.getItem(STORAGE_KEYS.STORES));
            
            const productSelect = document.getElementById('transferProduct');
            const fromStoreSelect = document.getElementById('transferFromStore');
            const toStoreSelect = document.getElementById('transferToStore');
            
            productSelect.innerHTML = '<option value="">Selecciona un producto</option>';
            products.forEach(p => {
                productSelect.innerHTML += `<option value="${p.id}">${p.name}</option>`;
            });
            
            fromStoreSelect.innerHTML = '<option value="">Selecciona tienda origen</option>';
            toStoreSelect.innerHTML = '<option value="">Selecciona tienda destino</option>';
            
            stores.forEach(s => {
                fromStoreSelect.innerHTML += `<option value="${s.id}">${s.name}</option>`;
                toStoreSelect.innerHTML += `<option value="${s.id}">${s.name}</option>`;
            });
        }

        function transferStock() {
            const productId = document.getElementById('transferProduct').value;
            const fromStoreId = document.getElementById('transferFromStore').value;
            const toStoreId = document.getElementById('transferToStore').value;
            const quantity = parseInt(document.getElementById('transferQuantity').value);
            
            if (!productId || !fromStoreId || !toStoreId || !quantity) {
                alert('Por favor completa todos los campos');
                return;
            }
            
            if (fromStoreId === toStoreId) {
                alert('La tienda origen y destino deben ser diferentes');
                return;
            }
            
            const stock = JSON.parse(localStorage.getItem(STORAGE_KEYS.STOCK));
            const fromStock = stock.find(s => s.productId === productId && s.storeId === fromStoreId);
            const toStock = stock.find(s => s.productId === productId && s.storeId === toStoreId);
            
            if (!fromStock || fromStock.quantity < quantity) {
                alert('Stock insuficiente en tienda origen');
                return;
            }
            
            // Perform transfer
            fromStock.quantity -= quantity;
            if (toStock) {
                toStock.quantity += quantity;
            } else {
                stock.push({
                    id: `stock-${productId}-${toStoreId}`,
                    productId,
                    storeId: toStoreId,
                    quantity,
                    updatedAt: new Date().toISOString()
                });
            }
            
            localStorage.setItem(STORAGE_KEYS.STOCK, JSON.stringify(stock));
            
            // Record transfer
            const transfers = JSON.parse(localStorage.getItem(STORAGE_KEYS.TRANSFERS));
            transfers.push({
                id: 'transfer-' + Date.now(),
                productId,
                fromStoreId,
                toStoreId,
                quantity,
                createdAt: new Date().toISOString()
            });
            localStorage.setItem(STORAGE_KEYS.TRANSFERS, JSON.stringify(transfers));
            
            alert('Transferencia realizada con √©xito');
            loadInventoryTable();
            loadAdminDashboard();
            
            // Clear form
            document.getElementById('transferProduct').value = '';
            document.getElementById('transferFromStore').value = '';
            document.getElementById('transferToStore').value = '';
            document.getElementById('transferQuantity').value = '';
        }

        function loadInventoryTable() {
            const products = JSON.parse(localStorage.getItem(STORAGE_KEYS.PRODUCTS));
            const stores = JSON.parse(localStorage.getItem(STORAGE_KEYS.STORES));
            const stock = JSON.parse(localStorage.getItem(STORAGE_KEYS.STOCK));
            
            let table = `
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b">
                            <th class="text-left p-2">Producto</th>
            `;
            
            stores.forEach(store => {
                table += `<th class="text-center p-2">${store.name}</th>`;
            });
            
            table += `
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            products.forEach(product => {
                table += `
                    <tr class="border-b">
                        <td class="p-2 font-medium">${product.name}</td>
                `;
                
                stores.forEach(store => {
                    const storeStock = stock.find(s => s.productId === product.id && s.storeId === store.id);
                    const quantity = storeStock ? storeStock.quantity : 0;
                    const color = quantity > 5 ? 'text-green-600' : quantity > 2 ? 'text-yellow-600' : 'text-red-600';
                    table += `<td class="text-center p-2 ${color} font-semibold">${quantity}</td>`;
                });
                
                table += `</tr>`;
            });
            
            table += `</tbody></table>`;
            document.getElementById('inventoryTable').innerHTML = table;
        }

        function loadProductsTable() {
            const products = JSON.parse(localStorage.getItem(STORAGE_KEYS.PRODUCTS));
            
            let table = `
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b">
                            <th class="text-left p-2">Producto</th>
                            <th class="text-left p-2">Precio</th>
                            <th class="text-center p-2">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            products.forEach(product => {
                table += `
                    <tr class="border-b">
                        <td class="p-2">
                            <div class="flex items-center space-x-3">
                                <img src="${product.imageUrl}" alt="${product.name}" class="w-10 h-10 object-cover rounded">
                                <div>
                                    <div class="font-medium">${product.name}</div>
                                    <div class="text-xs text-gray-600">${product.slug}</div>
                                </div>
                            </div>
                        </td>
                        <td class="p-2">Bs. ${product.price}</td>
                        <td class="p-2 text-center">
                            <button onclick="editProduct('${product.id}')" class="text-blue-600 hover:text-blue-800 mr-2">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                            </button>
                            <button onclick="deleteProduct('${product.id}')" class="text-red-600 hover:text-red-800">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            table += `</tbody></table>`;
            document.getElementById('productsTable').innerHTML = table;
            lucide.createIcons();
        }

        function showAddProductModal() {
            const stores = JSON.parse(localStorage.getItem(STORAGE_KEYS.STORES));
            const stockContainer = document.getElementById('newProductStock');
            
            stockContainer.innerHTML = '';
            stores.forEach(store => {
                stockContainer.innerHTML += `
                    <div class="flex items-center space-x-3">
                        <label class="flex-1 text-sm">${store.name}:</label>
                        <input type="number" min="0" data-store="${store.id}" class="w-24 border border-gray-300 rounded px-2 py-1">
                    </div>
                `;
            });
            
            document.getElementById('addProductModal').classList.remove('hidden');
            document.getElementById('addProductModal').classList.add('flex');
        }

        function closeAddProductModal() {
            document.getElementById('addProductModal').classList.add('hidden');
            document.getElementById('addProductModal').classList.remove('flex');
            
            // Clear form
            document.getElementById('newProductName').value = '';
            document.getElementById('newProductSlug').value = '';
            document.getElementById('newProductDescription').value = '';
            document.getElementById('newProductPrice').value = '';
            document.getElementById('newProductImage').value = '';
        }

        function addProduct() {
            const name = document.getElementById('newProductName').value;
            const slug = document.getElementById('newProductSlug').value;
            const description = document.getElementById('newProductDescription').value;
            const price = document.getElementById('newProductPrice').value;
            const imageUrl = document.getElementById('newProductImage').value;
            
            if (!name || !slug || !price) {
                alert('Por favor completa los campos obligatorios');
                return;
            }
            
            const products = JSON.parse(localStorage.getItem(STORAGE_KEYS.PRODUCTS));
            const product = {
                id: 'prod-' + Date.now(),
                name,
                slug,
                description,
                price,
                imageUrl: imageUrl || 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=400'
            };
            
            products.push(product);
            localStorage.setItem(STORAGE_KEYS.PRODUCTS, JSON.stringify(products));
            
            // Add stock for each store
            const stock = JSON.parse(localStorage.getItem(STORAGE_KEYS.STOCK));
            const stores = JSON.parse(localStorage.getItem(STORAGE_KEYS.STORES));
            const stockInputs = document.querySelectorAll('#newProductStock input');
            
            stockInputs.forEach(input => {
                const quantity = parseInt(input.value) || 0;
                if (quantity > 0) {
                    stock.push({
                        id: `stock-${product.id}-${input.dataset.store}`,
                        productId: product.id,
                        storeId: input.dataset.store,
                        quantity,
                        updatedAt: new Date().toISOString()
                    });
                }
            });
            
            localStorage.setItem(STORAGE_KEYS.STOCK, JSON.stringify(stock));
            
            alert('Producto agregado con √©xito');
            loadProductsTable();
            loadAdminDashboard();
            closeAddProductModal();
        }

        function deleteProduct(productId) {
            if (!confirm('¬øEst√°s seguro de eliminar este producto?')) return;
            
            let products = JSON.parse(localStorage.getItem(STORAGE_KEYS.PRODUCTS));
            products = products.filter(p => p.id !== productId);
            localStorage.setItem(STORAGE_KEYS.PRODUCTS, JSON.stringify(products));
            
            // Remove related stock
            let stock = JSON.parse(localStorage.getItem(STORAGE_KEYS.STOCK));
            stock = stock.filter(s => s.productId !== productId);
            localStorage.setItem(STORAGE_KEYS.STOCK, JSON.stringify(stock));
            
            alert('Producto eliminado');
            loadProductsTable();
            loadAdminDashboard();
        }

        function loadReports() {
            const stores = JSON.parse(localStorage.getItem(STORAGE_KEYS.STORES));
            const products = JSON.parse(localStorage.getItem(STORAGE_KEYS.PRODUCTS));
            const orders = JSON.parse(localStorage.getItem(STORAGE_KEYS.ORDERS));
            
            // Sales by store (simulated)
            const salesByStore = document.getElementById('salesByStore');
            salesByStore.innerHTML = '';
            
            stores.forEach((store, index) => {
                const sales = Math.floor(Math.random() * 50) + 10;
                const revenue = (sales * (Math.random() * 400 + 200)).toFixed(2);
                salesByStore.innerHTML += `
                    <div class="flex justify-between p-2 bg-gray-50 rounded">
                        <span>${store.name}</span>
                        <span class="font-semibold">Bs. ${revenue}</span>
                    </div>
                `;
            });
            
            // Top products (simulated)
            const topProducts = document.getElementById('topProducts');
            topProducts.innerHTML = '';
            
            const sortedProducts = [...products].sort(() => Math.random() - 0.5).slice(0, 5);
            sortedProducts.forEach((product, index) => {
                const sales = Math.floor(Math.random() * 30) + 5;
                topProducts.innerHTML += `
                    <div class="flex justify-between p-2 bg-gray-50 rounded">
                        <span>${index + 1}. ${product.name}</span>
                        <span class="font-semibold">${sales} unidades</span>
                    </div>
                `;
            });
        }

        function generateSalesReport() {
            alert('Generando reporte completo de ventas...\n\nEn implementaci√≥n real, esto descargar√≠a un PDF o Excel con datos detallados de ventas por tienda, productos m√°s vendidos, eficiencia del personal, etc.');
        }

        // Contact
        function loadContactForm() {
            const stores = JSON.parse(localStorage.getItem(STORAGE_KEYS.STORES));
            const storeSelect = document.getElementById('whatsappStore');
            
            storeSelect.innerHTML = '<option value="">Cualquier tienda</option>';
            stores.forEach(store => {
                storeSelect.innerHTML += `<option value="${store.id}">${store.name}</option>`;
            });
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeData();
            updateUIForLoggedInUser();
            updateCartCount();
            loadContactForm();
            
            // Load cart when cart view is shown
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.target.id === 'carrito' && mutation.target.classList.contains('active')) {
                        loadCart();
                    }
                });
            });
            
            document.querySelectorAll('.view').forEach(view => {
                observer.observe(view, { attributes: true, attributeFilter: ['class'] });
            });
        });

        // Global functions for onclick handlers
        window.showView = showView;
        window.showAdminSection = showAdminSection;
        window.showLoginModal = showLoginModal;
        window.closeLoginModal = closeLoginModal;
        window.login = login;
        window.logout = logout;
        window.viewProduct = viewProduct;
        window.addToCart = addToCart;
        window.addToCartFromDetail = addToCartFromDetail;
        window.updateCartItem = updateCartItem;
        window.removeFromCart = removeFromCart;
        window.checkout = checkout;
        window.sendWhatsApp = sendWhatsApp;
        window.filterByStore = filterByStore;
        window.transferStock = transferStock;
        window.showAddProductModal = showAddProductModal;
        window.closeAddProductModal = closeAddProductModal;
        window.addProduct = addProduct;
        window.deleteProduct = deleteProduct;
        window.generateSalesReport = generateSalesReport;
    </script>
</body>
</html>